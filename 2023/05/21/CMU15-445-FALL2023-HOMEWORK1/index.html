<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo_1.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo_1.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo_1.png">
  <link rel="mask-icon" href="/images/logo_1.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-pace-theme-center-circle.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"buttons","active":"valine","storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="1 实验准备 作业地址 实验当中提供的数据库，其中表关系如下：  索引创建如下： 12345678CREATE INDEX ix_people_name ON people (name);CREATE INDEX ix_titles_type ON titles (type);CREATE INDEX ix_titles_primary_title ON titles (primary_ti">
<meta property="og:type" content="article">
<meta property="og:title" content="CMU15-445-FALL2022-HOMEWORK1">
<meta property="og:url" content="https://example.com/2023/05/21/CMU15-445-FALL2023-HOMEWORK1/index.html">
<meta property="og:site_name" content="Trluper">
<meta property="og:description" content="1 实验准备 作业地址 实验当中提供的数据库，其中表关系如下：  索引创建如下： 12345678CREATE INDEX ix_people_name ON people (name);CREATE INDEX ix_titles_type ON titles (type);CREATE INDEX ix_titles_primary_title ON titles (primary_ti">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://example.com/CMU15-445-FALL2023-HOMEWORK1/schema.png">
<meta property="article:published_time" content="2023-05-21T07:37:00.000Z">
<meta property="article:modified_time" content="2023-06-06T07:25:15.529Z">
<meta property="article:author" content="trluper">
<meta property="article:tag" content="CMU15-445 lab">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://example.com/CMU15-445-FALL2023-HOMEWORK1/schema.png">

<link rel="canonical" href="https://example.com/2023/05/21/CMU15-445-FALL2023-HOMEWORK1/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>CMU15-445-FALL2022-HOMEWORK1 | Trluper</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Trluper</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/trluper" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://example.com/2023/05/21/CMU15-445-FALL2023-HOMEWORK1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="trluper">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Trluper">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          CMU15-445-FALL2022-HOMEWORK1
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-05-21 15:37:00" itemprop="dateCreated datePublished" datetime="2023-05-21T15:37:00+08:00">2023-05-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-06 15:25:15" itemprop="dateModified" datetime="2023-06-06T15:25:15+08:00">2023-06-06</time>
              </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>7.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>7 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="实验准备">1 实验准备</h3>
<p><a target="_blank" rel="noopener" href="https://15445.courses.cs.cmu.edu/fall2022/homework1/">作业地址</a></p>
<p>实验当中提供的数据库，其中表关系如下： <img src="/CMU15-445-FALL2023-HOMEWORK1/schema.png" width="700"></p>
<p>索引创建如下： <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CREATE INDEX ix_people_name ON <span class="title">people</span> <span class="params">(name)</span></span>;</span><br><span class="line"><span class="function">CREATE INDEX ix_titles_type ON <span class="title">titles</span> <span class="params">(type)</span></span>;</span><br><span class="line"><span class="function">CREATE INDEX ix_titles_primary_title ON <span class="title">titles</span> <span class="params">(primary_title)</span></span>;</span><br><span class="line"><span class="function">CREATE INDEX ix_titles_original_title ON <span class="title">titles</span> <span class="params">(original_title)</span></span>;</span><br><span class="line"><span class="function">CREATE INDEX ix_akas_title_id ON <span class="title">akas</span> <span class="params">(title_id)</span></span>;</span><br><span class="line"><span class="function">CREATE INDEX ix_akas_title ON <span class="title">akas</span> <span class="params">(title)</span></span>;</span><br><span class="line"><span class="function">CREATE INDEX ix_crew_title_id ON <span class="title">crew</span> <span class="params">(title_id)</span></span>;</span><br><span class="line"><span class="function">CREATE INDEX ix_crew_person_id ON <span class="title">crew</span> <span class="params">(person_id)</span></span>;</span><br></pre></td></tr></table></figure></p>
<h3 id="sqlite3的一些特性">2 SQLite3的一些特性</h3>
<ul>
<li><p><code>SQLite3</code>与<code>MySQL</code>的一些不同是一些命另和函数，其数据库的使用直接采用： <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ls</span><br><span class="line">imdb-cmudb2022.db  placeholder</span><br><span class="line">$ sqlite3 imdb-cmudb2022.db</span><br></pre></td></tr></table></figure></p></li>
<li><p>查看表： <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; .tables</span><br><span class="line">akas      crew      episodes  people    ratings   titles</span><br></pre></td></tr></table></figure></p></li>
<li><p>查看表结构 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; .<span class="function">schema people</span></span><br><span class="line"><span class="function">CREATE TABLE <span class="title">people</span> <span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  person_id VARCHAR PRIMARY KEY,</span></span></span><br><span class="line"><span class="params"><span class="function">  name VARCHAR,</span></span></span><br><span class="line"><span class="params"><span class="function">  born INTEGER,</span></span></span><br><span class="line"><span class="params"><span class="function">  died INTEGER</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br><span class="line"><span class="function">CREATE INDEX ix_people_name ON <span class="title">people</span> <span class="params">(name)</span></span>;</span><br></pre></td></tr></table></figure></p></li>
<li><p>更大命令使用<code>.help</code> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; .help</span><br></pre></td></tr></table></figure></p></li>
</ul>
<blockquote>
<p>注意，MySQL当中的一些函数，SQLite未必有，就如<code>concat</code>我就发现没有，SQLite使用<code>||</code>替代字符串拼接</p>
</blockquote>
<h3 id="实验问题">3 实验问题</h3>
<blockquote>
<p>2022 #### 3.1 <code>Q2 [5 points] (q2_sci_fi)</code> <code>Find the 10</code>Sci-Fi<code>works with the longest runtimes.</code> <strong><code>Details:</code></strong> <code>Print the title of the work, the premiere date, and the runtime. The column listing the runtime should be suffixed with the string &quot; (mins)&quot;, for example, if the runtime_mins value is</code>12<code>, you should output 12 (mins). Note a work is Sci-Fi even if it is categorized in multiple genres, as long as Sci-Fi is one of the genres.</code> <code>Your first row should look like this: Cicak-Man 2: Planet Hitam|2008|999 (mins)</code></p>
</blockquote>
<blockquote>
<p>找出10个运行时间最长的“科幻”作品。输出其<code>primary_title、primiered、runtime_minutes</code>，其中<code>runtime_minutes</code>后边要接<code>(mins)</code>。 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT PRIMARY_TITLE,PREMIERED,(RUNTIME_MINUTES||<span class="string">&#x27; (mins)&#x27;</span> )</span><br><span class="line">FROM TITLES </span><br><span class="line">WHERE GENRES LIKE <span class="string">&#x27;%Sci-Fi&#x27;</span> </span><br><span class="line">order by RUNTIME_MINUTES DESC LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<h4 id="q3_oldest_people">3.2 <code>q3_oldest_people</code></h4>
<p><code>Determine the oldest people in the dataset who were born in or after 1900. You should assume that a person without a known death year is still alive.</code> <strong>Details:</strong> <code>Print the name and age of each person. People should be ordered by a compound value of their age and secondly their name in alphabetical order. Return the first 20 results.</code></p>
</blockquote>
<blockquote>
<p>Your output should have the format: <code>NAME|AGE</code></p>
</blockquote>
<blockquote>
<p>找出出生于1900后（包含1900），年龄最大的20个人，按照年龄年龄和姓名的字母联合排序。注意没有死亡日期，证明还活着，你要能够处理这类数据 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select name,</span><br><span class="line"><span class="keyword">case</span></span><br><span class="line">    when died is null then <span class="number">2022</span>-born</span><br><span class="line">    <span class="keyword">else</span> died-born</span><br><span class="line">end as age</span><br><span class="line">from people</span><br><span class="line">where born&gt;=<span class="number">1900</span> order by age desc,name limit <span class="number">20</span>;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>2023</p>
</blockquote>
<h4 id="q2_not_the_same_title">3.1 <code>q2_not_the_same_title</code></h4>
<p><code>Find the 10 Action movies with the newest premiere date whose original title is not the same as its primary title.</code></p>
<p><strong>Details:</strong> Print the premiere year, followed by the two titles in a special format. The column listing the two titles should be in the format of primary_title (original_title) Note a work is Action even if it is categorized in multiple genres, as long as Action is one of the genres. Also note that it's possible for the premiered year to be in the future. If multiple movies premiered in the same year, order them alphabetically. Your first row should look like this:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT PREMIERED,(PRIMARY_TITLE||<span class="string">&#x27; (&#x27;</span>||ORIGINAL_TITLE||<span class="string">&#x27;)&#x27;</span>) AS T </span><br><span class="line">FROM TITLES </span><br><span class="line">WHERE PRIMARY_TITLE!=ORIGINAL_TITLE </span><br><span class="line">	AND GENRES LIKE <span class="string">&#x27;%Action%&#x27;</span> </span><br><span class="line">order by PREMIERED DESC,T LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>
<h4 id="q3_longest_running_tv">3.2 <code>q3_longest_running_tv</code></h4>
<p><code>Find the top 20 longest running tv series.</code></p>
<p><strong><code>Details</code>: </strong><code>Print the title and the years the series has been running for. The series must have a non NULL premiered year. If the ended date is NULL, assume it to be the current year (2023). If multiple tv series have been running the same number of years, order them alphabetically. Print the top 20 results.</code></p>
<p>Your output should have the format: TITLE|YEARS_RUNNING Your first row should look like this:<code>Looney Tunes|93</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT PRIMARY_TITLE,</span><br><span class="line">CASE </span><br><span class="line">	WHEN ENDED IS <span class="literal">NULL</span> THEN <span class="number">2023</span>-PREMIERED </span><br><span class="line">	ELSE ENDED-PREMIERED </span><br><span class="line">END AS YEARS_RUNNING </span><br><span class="line">FROM TITLES </span><br><span class="line">WHERE PREMIERED IS NOT <span class="literal">NULL</span> </span><br><span class="line">	AND TYPE=<span class="string">&#x27;tvSeries&#x27;</span> </span><br><span class="line">ORDER BY YEARS_RUNNING DESC,PRIMARY_TITLE LIMIT <span class="number">20</span>;</span><br></pre></td></tr></table></figure>
<h4 id="q4_directors_in_each_decade">3.3 <code>q4_directors_in_each_decade</code></h4>
<p>List the number directors born in each decade since 1900.(计算自1900年以来每10年出生的导演人数)</p>
<p><strong>Details:</strong> Print the decade in a fancier format by constructing a string that looks like this: 1990s. Order the results by decade.</p>
<p>Your output should look like this: <code>DECADE|NUM_DIRECTORS</code> Your first row should look like this: <code>1900s|376</code></p>
<p><strong>分析：从事领域存储在<code>crew</code>表的<code>category</code>,其中人的出生时期存储在<code>people</code>表，两表通过<code>person_id</code>联结，<code>people</code>的为主键，<code>crew</code>的为外键</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SELECT decade || <span class="string">&#x27;s&#x27;</span>,</span><br><span class="line">    <span class="built_in">COUNT</span>(*)</span><br><span class="line"><span class="built_in">FROM</span> (</span><br><span class="line">        SELECT <span class="built_in">DISTINCT</span>(people.person_id),</span><br><span class="line">            <span class="built_in">FLOOR</span>(people.born / <span class="number">10</span>) * <span class="number">10</span> AS decade</span><br><span class="line">        FROM people</span><br><span class="line">            INNER JOIN crew ON crew.person_id = people.person_id</span><br><span class="line">        WHERE crew.category = <span class="string">&#x27;director&#x27;</span></span><br><span class="line">            AND people.born &gt;= <span class="number">1900</span></span><br><span class="line">    )</span><br><span class="line">GROUP BY decade</span><br><span class="line">ORDER BY decade;</span><br></pre></td></tr></table></figure>
<p><strong>上面的group by decade1</strong>最重要，这样<code>count()</code>会以<code>decade</code>组区分进行统计</p>
<h4 id="q5_german_type_ratings">3.4 <code>q5_german_type_ratings</code></h4>
<p><code>Compute statistics about different type of works that has a German title</code>.(计算具有德语标题的不同类型作品的统计数据。) <strong><code>Details:</code></strong> <code>Compute the average (rounded to 2 decimal places), min, and max rating for each type of work that has a German title and the akas types is either imdbDisplay or original. Sort the output by the average rating of each title type.</code>(计算具有德语标题且<code>akas</code>类型为<code>imdbDisplay</code>或<code>original</code>的每种类型的作品的平均值(舍入到小数点后2位)、最小值和最大值。按每个标题类型的平均评分对输出进行排序。)</p>
<p>Your output should have the format: <code>TITLE_TYPE|AVG_RATING|MIN_RATING|MAX_RATING</code> Your first row should look like this:<code>movie|6.65|3.4|8.2</code></p>
<p><strong>分析：<code>titles</code>表、<code>akas</code>和<code>ratings</code>表通过<code>title_id</code>进行联结，其中<code>titles</code>中作为主键，<code>akas</code>和<code>ratings</code>作为外键。要求<code>akas.types in ('imdbDisplay','original') and akas.language='de'</code>,计算平均值、最大值、最小值</strong>。为三表查询</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT T.TYPE, <span class="built_in">ROUND</span>(<span class="built_in">AVG</span>(R.RATING),<span class="number">2</span>),<span class="built_in">MIN</span>(R.RATING),<span class="built_in">MAX</span>(R.RATING)</span><br><span class="line">FROM TITLES AS T</span><br><span class="line">	INNER JOIN AKAS AS A ON T.TITLE_ID=A.TITLE_ID</span><br><span class="line">	INNER JOIN RATINGS AS R ON T.TITLE_ID=R.TITLE_ID</span><br><span class="line">WHERE A.TYPES <span class="built_in">IN</span> (<span class="string">&#x27;imdbDisplay&#x27;</span>,<span class="string">&#x27;original&#x27;</span>)</span><br><span class="line">	AND A.LANGUAGE=<span class="string">&#x27;de&#x27;</span></span><br><span class="line">GROUP BY T.TYPE</span><br><span class="line">ORDER BY T.TYPE;</span><br></pre></td></tr></table></figure>
<h4 id="q6_who_played_a_batman">3.5 <code>q6_who_played_a_batman</code></h4>
<p><code>List the 10 highest rated actors who played a character named &quot;Batman&quot;.</code>(请列出出演过“蝙蝠侠”角色的10位评价最高的演员) <strong><code>Details:</code> </strong><code>Calculate the actor rating by taking the average rating of all their works. Return both the name of the actor and their rating and only list the top 10 results in order from highest to lowest rating. Round average rating to the nearest hundredth.</code>(通过取所有作品的平均评分来计算演员的评分。返回演员的名字和他们的评分，并且只按评分从高到低的顺序列出前10个结果。四舍五入平均评级到最接近的百分之一。)</p>
<p>Make sure your output is formatted as follows: <code>Kayd Currier|8.05</code></p>
<p><strong>分析</strong>：<code>name</code>在<code>people</code>表，<code>rating</code>在<code>ratings</code>表，<code>characters</code>在<code>crew</code>表，其中三者的联结依赖主外键，<code>ratings</code>和<code>crew</code>通过<code>title_id</code>联结，<code>crew</code>和<code>people</code>通过<code>person_id</code>联结，要求<code>crew.characters like '%Batman%'</code>。<strong>可将<code>people</code>和<code>crew</code>先用<code>person_id</code>进行内连接得到actor,然后利用actor与<code>ratings</code>连接</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">WITH actors <span class="title">AS</span> <span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    SELECT DISTINCT(crew.person_id) AS person_id,</span></span></span><br><span class="line"><span class="params"><span class="function">        people.name AS person_name</span></span></span><br><span class="line"><span class="params"><span class="function">    FROM crew</span></span></span><br><span class="line"><span class="params"><span class="function">        INNER JOIN people ON people.person_id = crew.person_id</span></span></span><br><span class="line"><span class="params"><span class="function">    WHERE crew.characters LIKE <span class="string">&#x27;%&quot;Batman&quot;%&#x27;</span></span></span></span><br><span class="line"><span class="params"><span class="function">        AND crew.category = <span class="string">&quot;actor&quot;</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function">SELECT a.person_name,</span></span><br><span class="line"><span class="function">    <span class="title">ROUND</span><span class="params">(AVG(rating), <span class="number">2</span>)</span> AS average</span></span><br><span class="line"><span class="function">FROM actors AS a</span></span><br><span class="line"><span class="function">    INNER JOIN crew AS c ON c.person_id </span>= a.person_id</span><br><span class="line">    INNER JOIN ratings AS r ON c.title_id = r.title_id</span><br><span class="line">GROUP BY a.person_id</span><br><span class="line">ORDER BY average DESC</span><br><span class="line">LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>
<p>上述等价于： <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SELECT A.name,<span class="built_in">ROUND</span>(<span class="built_in">AVG</span>(R.rating),<span class="number">2</span>) <span class="function">AS SCORE</span></span><br><span class="line"><span class="function"><span class="title">FROM</span> <span class="params">(SELECT DISTINCT(C.person_id),P.name,C.title_id</span></span></span><br><span class="line"><span class="params"><span class="function">	FROM crew AS C</span></span></span><br><span class="line"><span class="params"><span class="function">	INNER JOIN people AS P ON C.person_id=P.person_id</span></span></span><br><span class="line"><span class="params"><span class="function">	WHERE C.characters LIKE <span class="string">&#x27;%&quot;Batman&quot;%&#x27;</span></span></span></span><br><span class="line"><span class="params"><span class="function">		AND C.category = <span class="string">&#x27;actor&#x27;</span></span></span></span><br><span class="line"><span class="params"><span class="function">	)</span> AS A</span></span><br><span class="line"><span class="function">	INNER JOIN crew AS C ON C.person_id</span>=A.person_id</span><br><span class="line">	INNER JOIN ratings AS R ON C.title_id=R.title_id</span><br><span class="line">GROUP BY A.person_id</span><br><span class="line">ORDER BY SCORE DESC</span><br><span class="line">LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure></p>
<h4 id="q7_born_with_prestige">3.6 <code>q7_born_with_prestige</code></h4>
<p><code>List the number of actors or actress who were born on the year that &quot;The Prestige&quot; was premiered.</code>(列出在《致命魔术》首映那一年出生的演员人数。) <strong><code>Details</code>:</strong> <code>Print only the total number of actors born that year. For this question, determine distinct people by their person_id, not their names. Do not hard code the query.</code>(只打印当年出生的演员总数。对于这个问题，确定不同的人通过他们的person_id，而不是他们的名字。不要硬编码查询。)</p>
<p><strong>分析</strong>：<code>born</code>在<code>people</code>表，<code>primary_title</code>在<code>title</code>表，因此需要将<code>crew</code>与<code>people</code>联结起来。加上条件<code>category IN ('actor', 'actress')和primary_title = 'The Prestige'</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">SELECT <span class="title">COUNT</span><span class="params">(DISTINCT(p.person_id))</span></span></span><br><span class="line"><span class="function">FROM people AS p</span></span><br><span class="line"><span class="function">    INNER JOIN crew AS c ON p.person_id </span>= c.person_id</span><br><span class="line">WHERE c.<span class="function">category <span class="title">IN</span> <span class="params">(<span class="string">&#x27;actor&#x27;</span>, <span class="string">&#x27;actress&#x27;</span>)</span></span></span><br><span class="line"><span class="function">    AND p.born <span class="title">IN</span> <span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        SELECT premiered</span></span></span><br><span class="line"><span class="params"><span class="function">        FROM titles</span></span></span><br><span class="line"><span class="params"><span class="function">        WHERE primary_title = <span class="string">&#x27;The Prestige&#x27;</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>;</span><br></pre></td></tr></table></figure>
<h4 id="q8_directing_rose.sql">3.7 <code>q8_directing_rose.sql</code></h4>
<p><code>Find all the directors who have worked with an actress with first name &quot;Rose&quot;.</code>(找出所有与名字为“Rose”的女演员合作过的导演。) <strong><code>Details:</code></strong> <code>Print only the names of the directors in alphabetical order. Each name should only appear once in the output.</code></p>
<p><strong>分析：</strong><code>category</code>在表<code>crew</code>,<code>name</code>在<code>people</code></p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> title_ids <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> c.title_id <span class="keyword">AS</span> title_id</span><br><span class="line">    <span class="keyword">FROM</span> crew <span class="keyword">AS</span> c</span><br><span class="line">        <span class="keyword">INNER</span> <span class="keyword">JOIN</span> people <span class="keyword">AS</span> p <span class="keyword">ON</span> p.person_id = c.person_id</span><br><span class="line">    <span class="keyword">WHERE</span> p.name <span class="keyword">like</span> <span class="string">&#x27;Rose%&#x27;</span></span><br><span class="line">        <span class="keyword">AND</span> c.category = <span class="string">&#x27;actress&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span>(p.name) <span class="keyword">AS</span> <span class="type">name</span></span><br><span class="line"><span class="keyword">FROM</span> title_ids <span class="keyword">AS</span> t</span><br><span class="line">    <span class="keyword">INNER</span> <span class="keyword">JOIN</span> crew <span class="keyword">AS</span> c <span class="keyword">ON</span> t.title_id = c.title_id</span><br><span class="line">    <span class="keyword">INNER</span> <span class="keyword">JOIN</span> people <span class="keyword">AS</span> p <span class="keyword">ON</span> p.person_id = c.person_id</span><br><span class="line"><span class="keyword">WHERE</span> c.category = <span class="string">&#x27;director&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="type">name</span>;</span><br></pre></td></tr></table></figure>
<h4 id="section">3.8</h4>

    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="trluper 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="trluper 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/CMU15-445-lab/" rel="tag"># CMU15-445 lab</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/05/17/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98/" rel="prev" title="深入理解计算机系统-虚拟内存">
      <i class="fa fa-chevron-left"></i> 深入理解计算机系统-虚拟内存
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/05/22/CMU15-445-FALL2023-PROJECT-0/" rel="next" title="CMU15-445-FALL2022-PROJECT_0">
      CMU15-445-FALL2022-PROJECT_0 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E5%87%86%E5%A4%87"><span class="nav-number">1.</span> <span class="nav-text">1 实验准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sqlite3%E7%9A%84%E4%B8%80%E4%BA%9B%E7%89%B9%E6%80%A7"><span class="nav-number">2.</span> <span class="nav-text">2 SQLite3的一些特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E9%97%AE%E9%A2%98"><span class="nav-number">3.</span> <span class="nav-text">3 实验问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#q3_oldest_people"><span class="nav-number">3.1.</span> <span class="nav-text">3.2 q3_oldest_people</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#q2_not_the_same_title"><span class="nav-number">3.2.</span> <span class="nav-text">3.1 q2_not_the_same_title</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#q3_longest_running_tv"><span class="nav-number">3.3.</span> <span class="nav-text">3.2 q3_longest_running_tv</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#q4_directors_in_each_decade"><span class="nav-number">3.4.</span> <span class="nav-text">3.3 q4_directors_in_each_decade</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#q5_german_type_ratings"><span class="nav-number">3.5.</span> <span class="nav-text">3.4 q5_german_type_ratings</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#q6_who_played_a_batman"><span class="nav-number">3.6.</span> <span class="nav-text">3.5 q6_who_played_a_batman</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#q7_born_with_prestige"><span class="nav-number">3.7.</span> <span class="nav-text">3.6 q7_born_with_prestige</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#q8_directing_rose.sql"><span class="nav-number">3.8.</span> <span class="nav-text">3.7 q8_directing_rose.sql</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#section"><span class="nav-number">3.9.</span> <span class="nav-text">3.8</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="trluper"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">trluper</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">74</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">34</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/trluper" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;trluper" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Trluper</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">1.1m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">17:01</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<!-- LOCAL: You can save these files to your site and update links -->
  
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<!-- END LOCAL -->
 
    
      <script type="text/javascript">
      function renderGitalk(){
        var gitalk = new Gitalk({
            owner: '',
            repo: '',
            clientID: '123fe329fdbb06b0f1d1',
            clientSecret: '40add829107b6e69f43274d3545ae71c988de8eb',
            admin: '',
            
            });
        gitalk.render('gitalk-container');
      }
      renderGitalk();
      </script>
    
 


<script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>